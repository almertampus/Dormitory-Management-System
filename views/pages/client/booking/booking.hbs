{{#extend "layout"}}

{{#content "extra_css"}}
<style>
    body {
        background-color: #F4F5F4;
    }
</style>
{{/content}}

{{#content "content"}}

<main id="booking">
    <div class="container-fluid">
        <div class="row">
            <form action="/api/booking/{{property.bookingId}}" method="post" novalidate>
                <!-- First tab -->
                <div class="col-md-5 rounded" id="f_tab">
                    <header class="mb-3">
                        <h4 class="mb-0 font-weight-bold">Personal information</h4>
                    </header>
                    <section class="">
                        <h5 class="mb-3 font-weight-normal">May we know about you?</h5>
                        <div class="form-group mb-2">
                            <label class="d-flex align-items-center" for="first_name">
                                <div class="d-flex align-items-center" id="first_name_indicator"></div>
                                First name
                            </label>
                            <input class="form-control" name="first_name" id="first_name" type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label class="d-flex align-items-center" for="last_name">
                                <div class="d-flex align-items-center" id="last_name_indicator"></div>
                                Last name
                            </label>
                            <input class="form-control" name="last_name" id="last_name" type="text">
                        </div>
                        <div class="form-group mb-2">
                            <label class="d-flex align-items-center" for="birthday">
                                <div class="d-flex align-items-center" id="birthday_indicator"></div>
                                Birthday
                            </label>
                            <input class="form-control" name="birthday" id="birthday" type="date">
                        </div>
                        <h5 class="mt-4 mb-3 font-weight-normal">How can we contact you?</h5>
                        <div class="form-group mb-2">
                            <label class="d-flex align-items-center" for="mobile">
                                <div class="d-flex align-items-center" id="mobile_indicator"></div>
                                Mobile
                            </label>
                            <input class="form-control" name="mobile" id="mobile" type="number">
                        </div>
                        <div class="form-group mb-2">
                            <label class="d-flex align-items-center" for="email">
                                <div class="d-flex align-items-center" id="email_indicator"></div>
                                Email
                            </label>
                            <input class="form-control" name="email" id="email" type="email">
                        </div>
                        <button type="button" class="btn mt-4 m-0" id="f_tab_btn">Next</button>
                    </section>
                </div>
                <!-- Second tab -->
                <div class="col-md-5 rounded d-none" id="s_tab">
                    <header class="mb-3">
                        <h4 class="mb-0 font-weight-bold">Room information</h4>
                    </header>
                    <section class="d-flex flex-column">
                        <h5 class="mb-3 font-weight-normal">Choose your preferred room type</h5>
                        {{#each catalogs}}
                        <div class="form-group mb-0">
                            <label class="radio-label" for="{{name}}" id="label-{{_id}}" onclick="radioSelected(this)"
                                data-name="{{name}}" data-rate="{{rate}}">
                                <div class="card mb-2 rounded-0 z-depth-0">
                                    <div class="card-body">
                                        <h4 class="card-title">{{name}}</h4>
                                        <p class="card-text mb-0">P{{rate}}/month</p>
                                        <input type="radio" name="catalog" id="{{name}}" value="{{_id}}">
                                    </div>
                                </div>
                            </label>
                        </div>
                        {{/each}}
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn m-0 mr-3" id="s_tab_btn_prev">Previous</button>
                            <button type="button" class="btn m-0" id="s_tab_btn_rev">Review</button>
                        </div>
                    </section>
                </div>
                <!-- Third tab -->
                <div class="col-md-5 rounded d-none" id="t_tab">
                    <header class="mb-3">
                        <h4 class="mb-0 font-weight-bold">Review</h4>
                    </header>
                    <section class="d-flex flex-column">
                        <h5 class="mb-3 font-weight-normal">Personal information</h5>
                        <table class="table table-sm table-borderless">
                            <tbody class="text-black-50">
                                <tr>
                                    <td>Name</td>
                                    <td id="td_name"></td>
                                </tr>
                                <tr>
                                    <td>Birthday</td>
                                    <td id="td_birthday"></td>
                                </tr>
                                <tr>
                                    <td>Mobile</td>
                                    <td id="td_mobile"></td>
                                </tr>
                                <tr>
                                    <td>Email</td>
                                    <td id="td_email"></td>
                                </tr>
                            </tbody>
                        </table>
                        <h5 class="mb-3 font-weight-normal">Booking details</h5>
                        <div class="">
                            <div class="card mb-2 rounded-0 z-depth-0 bg-white">
                                <div class="card-body">
                                    <h4 class="card-title" id="review_catalog_name"></h4>
                                    <p class="card-text mb-0" id="review_catalog_rate"></p>
                                </div>
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn m-0 mr-3" id="t_tab_btn_prev">Previous</button>
                            <button type="submit" class="btn m-0" id="t_tab_btn_next">Submit</button>
                        </div>
                    </section>
                </div>
            </form>
        </div>
    </div>
</main>

{{/content}}

{{#content "extra_js"}}
<script type="text/javascript">
    $(document).ready(function () {

        $(document).on('keypress', 'form', function (e) {
            var code = e.keyCode || e.which;
            if (code == 13) {
                e.preventDefault();
                return false;
            }
        });

        const err_svg = '<svg class="mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="red" width="18px" height="18px"><path d="M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></svg>'
        const succ_svg = '<svg class="mr-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="green" width="18px" height="18px"><path d="M0 0h24v24H0V0zm0 0h24v24H0V0z" fill="none"/><path d="M16.59 7.58L10 14.17l-3.59-3.58L5 12l5 5 8-8zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/></svg>'

        // First tab validation
        $('#f_tab_btn').on('click', function () {
            let first_name = $('#first_name').val()
            let last_name = $('#last_name').val()
            let birthday = $('#birthday').val()
            let mobile = $('#mobile').val()
            let email = $('#email').val()

            function validEmail(email) {
                let regex = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                if (!regex.test(email)) {
                    return false;
                } else {
                    return true;
                }
            }

            // First name validity check
            if (first_name === '') {
                $('#first_name_indicator')
                    .html(err_svg)
            } else {
                $('#first_name_indicator')
                    .html(succ_svg)
            }
            // Last name validity check
            if (last_name === '') {
                $('#last_name_indicator')
                    .html(err_svg)
            } else {
                $('#last_name_indicator')
                    .html(succ_svg)
            }
            // Birthday validity check
            if (!birthday) {
                $('#birthday_indicator')
                    .html(err_svg)
            } else {
                $('#birthday_indicator')
                    .html(succ_svg)
            }
            // Mobile validity check
            if (mobile === '') {
                $('#mobile_indicator')
                    .html(err_svg)
            } else {
                $('#mobile_indicator')
                    .html(succ_svg)
            }
            // Email validity check
            if (!validEmail(email)) {
                $('#email_indicator')
                    .html(err_svg)
            } else {
                $('#email_indicator')
                    .html(succ_svg)
            }

            if (first_name != '' && first_name != '' && birthday != '' && mobile != '' && validEmail(email)) {
                $('#f_tab')
                    .addClass('d-none')
                $('#s_tab')
                    .removeClass('d-none')
            }
        })

        $('#s_tab_btn_prev').on('click', function () {
            $('#s_tab')
                .addClass('d-none')
            $('#f_tab')
                .removeClass('d-none')
        })

        $('#s_tab_btn_rev').on('click', function () {
            let name = $('#first_name').val() + ' ' + $('#last_name').val()
            let birthday = $('#birthday').val()
            let mobile = $('#mobile').val()
            let email = $('#email').val()

            $('#td_name').text(name)
            $('#td_birthday').text(birthday)
            $('#td_mobile').text(mobile)
            $('#td_email').text(email)

            if ($('input[name=catalog]:checked').length > 0) {
                $('#s_tab')
                    .addClass('d-none')
                $('#t_tab')
                    .removeClass('d-none')
            }
        })

        $('#t_tab_btn_prev').on('click', function () {
            $('#t_tab')
                .addClass('d-none')
            $('#s_tab')
                .removeClass('d-none')
        })
    })

    function radioSelected(element) {
        let selected = element.id

        $('.radio-label')
            .attr('style', 'background-color: #ffffff;')
        $('#' + selected)
            .attr('style', 'color: #ffffff !important;background-color: #17457e;')

        let catalog_name = $(element).attr('data-name')
        let catalog_rate = $(element).attr('data-rate')

        console.log(catalog_name)

        $('#review_catalog_name')
            .text(catalog_name)
        $('#review_catalog_rate')
            .text('P' + catalog_rate + '/month')
    }
</script>


{{/content}}

{{/extend}}